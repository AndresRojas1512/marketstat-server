scalar Date
scalar DateTime
scalar Decimal
scalar Long
scalar Short

schema {
  query: Query
  mutation: Mutation
}

# query mapper

type Query {
  "Authentication and User Profile queries."
  auth: AuthQueries

  "Analytical and Fact data queries (Salaries)."
  salaries: FactSalaryQueries

  "Dimension data queries."
  dates: DimDateQueries
  locations: DimLocationQueries
  jobs: DimJobQueries
  industries: DimIndustryFieldQueries
  employers: DimEmployerQueries
  employees: DimEmployeeQueries
  educations: DimEducationQueries
}

# mutation mapper

type Mutation {
  "Authentication and User actions."
  auth: AuthMutations

  "Salary Fact modifications."
  salaries: FactSalaryMutations

  "Dimension modifications."
  dates: DimDateMutations
  locations: DimLocationMutations
  jobs: DimJobMutations
  industries: DimIndustryFieldMutations
  employers: DimEmployerMutations
  employees: DimEmployeeMutations
  educations: DimEducationMutations
}

# queries

type AuthQueries {
  me: UserDto
}

type FactSalaryQueries {
  getById(id: String): FactSalaryDto
  getAll(filter: SalaryFilterInput): [FactSalaryDto]
  getDistribution(filter: SalaryFilterInput): [SalaryDistributionBucketDto]
  getSummary(request: SalarySummaryRequestInput): SalarySummaryDto
  getTimeSeries(request: SalaryTimeSeriesRequestInput): [SalaryTimeSeriesPointDto]
  getPublicRoles(request: PublicRolesRequestInput): [PublicRoleByLocationIndustryDto]
}

type DimDateQueries {
  getById(id: Int): DimDateDto
  getAll: [DimDateDto]
}

type DimLocationQueries {
  getById(id: Int): DimLocationDto
  getAll: [DimLocationDto]
  getDistricts: [String]
  getOblasts(districtName: String): [String]
  getCities(oblastName: String): [String]
}

type DimJobQueries {
  getById(id: Int): DimJobDto
  getAll: [DimJobDto]
  getStandardRoles(industryFieldId: Int): [String]
  getHierarchyLevels(industryFieldId: Int, standardJobRoleTitle: String): [String]
}

type DimIndustryFieldQueries {
  getById(id: Int): DimIndustryFieldDto
  getAll: [DimIndustryFieldDto]
}

type DimEmployerQueries {
  getById(id: Int): DimEmployerDto
  getAll: [DimEmployerDto]
}

type DimEmployeeQueries {
  getById(id: Int): DimEmployeeDto
  getAll: [DimEmployeeDto]
}

type DimEducationQueries {
  getById(id: Int): DimEducationDto
  getAll: [DimEducationDto]
}

# mutations

type AuthMutations {
  registerUser(input: RegisterUserInput): UserDto
  loginUser(input: LoginRequestInput): AuthResponseDto
  updateProfile(input: PartialUpdateUserInput): UserDto
}

type FactSalaryMutations {
  create(input: CreateFactSalaryInput): FactSalaryDto
  update(id: String, input: UpdateFactSalaryInput): FactSalaryDto
  delete(id: String): Boolean
}

type DimDateMutations {
  create(input: CreateDimDateInput): DimDateDto
  update(id: Int, input: UpdateDimDateInput): DimDateDto
  delete(id: Int): Boolean
}

type DimLocationMutations {
  create(input: CreateDimLocationInput): DimLocationDto
  update(id: Int, input: UpdateDimLocationInput): DimLocationDto
  delete(id: Int): Boolean
}

type DimEducationMutations {
  create(input: CreateDimEducationInput): DimEducationDto
  update(id: Int, input: UpdateDimEducationInput): DimEducationDto
  delete(id: Int): Boolean
}

type DimEmployeeMutations {
  create(input: CreateDimEmployeeInput): DimEmployeeDto
  update(id: Int, input: UpdateDimEmployeeInput): DimEmployeeDto
  patch(id: Int, input: PartialUpdateDimEmployeeInput): DimEmployeeDto
  delete(id: Int): Boolean
}

type DimEmployerMutations {
  create(input: CreateDimEmployerInput): DimEmployerDto
  update(id: Int, input: UpdateDimEmployerInput): DimEmployerDto
  delete(id: Int): Boolean
}

type DimIndustryFieldMutations {
  create(input: CreateDimIndustryFieldInput): DimIndustryFieldDto
  update(id: Int, input: UpdateDimIndustryFieldInput): DimIndustryFieldDto
  delete(id: Int): Boolean
}

type DimJobMutations {
  create(input: CreateDimJobInput): DimJobDto
  update(id: Int, input: UpdateDimJobInput): DimJobDto
  delete(id: Int): Boolean
}

# dtos

type FactSalaryDto {
  salaryFactId: String
  salaryAmount: Float
  date: DimDateDto
  location: DimLocationDto
  employer: DimEmployerDto
  job: DimJobDto
  employee: DimEmployeeDto
}

type DimLocationDto {
  locationId: Int
  cityName: String
  oblastName: String
  districtName: String
}

type DimJobDto {
  jobId: Int
  jobRoleTitle: String
  standardJobRoleTitle: String
  hierarchyLevelName: String
  industryField: DimIndustryFieldDto
}

type DimIndustryFieldDto {
  industryFieldId: Int
  industryFieldCode: String
  industryFieldName: String
}

type DimEmployerDto {
  employerId: Int
  employerName: String
  inn: String
  registrationDate: String
  industryField: DimIndustryFieldDto
}

type DimEmployeeDto {
  employeeId: Int
  employeeRefId: String
  birthDate: String
  education: DimEducationDto
}

type DimEducationDto {
  educationId: Int
  specialtyName: String
  educationLevelName: String
}

type DimDateDto {
  dateId: Int
  fullDate: String
  year: Int
  quarter: Int
  month: Int
}

type UserDto {
  userId: Int
  username: String
  email: String
  fullName: String
  isActive: Boolean
}

type AuthResponseDto {
  token: String
  expiration: String
  user: UserDto
}

type SalaryDistributionBucketDto {
  lowerBound: Float
  upperBound: Float
  bucketCount: Int
}

type SalarySummaryDto {
  averageSalary: Float
  totalCount: Int
  percentile50: Float
}

type SalaryTimeSeriesPointDto {
  periodStart: String
  avgSalary: Float
}

type PublicRoleByLocationIndustryDto {
  standardJobRoleTitle: String
  averageSalary: Float
}

# input types

input RegisterUserInput { username: String, email: String }
input LoginRequestInput { username: String, password: String }
input PartialUpdateUserInput { email: String }

input SalaryFilterInput { cityName: String }
input SalarySummaryRequestInput { targetPercentile: Int }
input SalaryTimeSeriesRequestInput { periods: Int }
input PublicRolesRequestInput { minRecordCount: Int }

input CreateFactSalaryInput { dateId: Int, locationId: Int, salaryAmount: Float }
input UpdateFactSalaryInput { salaryAmount: Float }

input CreateDimDateInput { fullDate: String }
input UpdateDimDateInput { fullDate: String }

input CreateDimLocationInput { cityName: String }
input UpdateDimLocationInput { cityName: String }

input CreateDimEducationInput { specialtyName: String }
input UpdateDimEducationInput { specialtyName: String }

input CreateDimEmployeeInput { employeeRefId: String }
input UpdateDimEmployeeInput { employeeRefId: String }
input PartialUpdateDimEmployeeInput { employeeRefId: String }

input CreateDimEmployerInput { employerName: String }
input UpdateDimEmployerInput { employerName: String }

input CreateDimIndustryFieldInput { industryFieldCode: String }
input UpdateDimIndustryFieldInput { industryFieldCode: String }

input CreateDimJobInput { jobRoleTitle: String }
input UpdateDimJobInput { jobRoleTitle: String }